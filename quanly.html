<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản Lý Phòng Trọ</title>
  <style>
    body {font-family: Arial, sans-serif; background:#f4f6f9; margin:20px;}
    h2 {margin-top:40px; color:#2c3e50;}
    form {background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1);}
    form div {margin-bottom:10px;}
    label {display:inline-block; width:120px; font-weight:bold;}
    input, select {padding:6px; width:200px;}
    button {padding:6px 12px; margin-right:5px; border:none; border-radius:4px; cursor:pointer;}
    button.add {background:#3498db; color:#fff;}
    button.edit {background:#f39c12; color:#fff;}
    button.delete {background:#e74c3c; color:#fff;}
    input[type="search"] {padding:6px; width:300px; margin:10px 0;}
    table {width:100%; border-collapse:collapse; background:#fff; margin-top:10px;}
    th, td {border:1px solid #ccc; padding:8px; text-align:left;}

    td button {margin:0 2px;}
  </style>
</head>
<body>

 <h2>Quản lý Khách Thuê</h2>
  <form id="tenantForm">
    <input type="hidden" id="tenantIndex">
    <div><label>CCCD/CMND:</label><input type="text" id="cccd" required></div>
    <div><label>Họ Tên:</label><input type="text" id="ten" required></div>
    <div><label>SĐT:</label><input type="text" id="sdt" required></div>
    <div><label>Ngày Sinh:</label><input type="date" id="ngaySinh"></div>
    <div><label>Địa Chỉ:</label><input type="text" id="diaChi"></div>
    <div><label>Tệp đính kèm:</label><input type="file" id="file"></div>
    <button type="submit" class="add">Lưu khách thuê</button>
  </form>

  <input type="search" id="tenantSearch" placeholder="Tìm kiếm khách thuê...">
  <table id="tenantTable">
    <thead>
      <tr><th>CCCD/CMND</th><th>Họ tên</th><th>SĐT</th><th>Ngày sinh</th><th>Địa chỉ</th><th>Tệp</th><th>Hành động</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Quản lý Hợp Đồng</h2>
  <form id="contractForm">
    <input type="hidden" id="contractIndex">
    <div><label>Mã Hợp Đồng:</label><input type="text" id="maHD" required></div>
    <div><label>Mã Phòng:</label><input type="text" id="maPhong" required></div>
    <div><label>Khách Thuê:</label>
      <select id="contractTenant" required>
        <option value="">-- Chọn khách thuê --</option>
      </select>
    </div>
    <div><label>Ngày Bắt Đầu:</label><input type="date" id="ngayBD"></div>
    <div><label>Ngày Kết Thúc:</label><input type="date" id="ngayKT"></div>
    <div><label>Tiền Cọc:</label><input type="number" id="tienCoc"></div>
    <button type="submit" class="add">Lưu hợp đồng</button>
  </form>

  <input type="search" id="contractSearch" placeholder="Tìm kiếm hợp đồng...">
  <table id="contractTable">
    <thead>
      <tr><th>Mã HĐ</th><th>Mã Phòng</th><th>Khách thuê</th><th>Bắt đầu</th><th>Kết thúc</th><th>Tiền cọc</th><th>Hành động</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  let tenants = [];
  let contracts = [];

  // Thêm / Sửa Khách thuê
  document.getElementById("tenantForm").addEventListener("submit", e => {
    e.preventDefault();
    const idx = document.getElementById("tenantIndex").value;
    const data = {
      cccd: document.getElementById("cccd").value,
      ten: document.getElementById("ten").value,
      sdt: document.getElementById("sdt").value,
      ngaySinh: document.getElementById("ngaySinh").value,
      diaChi: document.getElementById("diaChi").value,
      file: document.getElementById("file").value.split("\\").pop()
    };
    if (idx === "") {
      tenants.push(data);
    } else {
      tenants[idx] = data;
    }
    e.target.reset();
    document.getElementById("tenantIndex").value = "";
    renderTenants();
    updateTenantSelect();
  });

  // Hiển thị Khách thuê
  function renderTenants() {
    const tbody = document.querySelector("#tenantTable tbody");
    tbody.innerHTML = "";
    const search = document.getElementById("tenantSearch").value.toLowerCase();
    tenants.filter(t => t.ten.toLowerCase().includes(search) || t.cccd.includes(search)).forEach((t, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${t.cccd}</td><td>${t.ten}</td><td>${t.sdt}</td>
      <td>${t.ngaySinh}</td><td>${t.diaChi}</td><td>${t.file || ""}</td>
      <td>
        <button class="edit" onclick="editTenant(${i})">✏️</button>
        <button class="delete" onclick="deleteTenant(${i})">❌</button>
      </td>`;
      tbody.appendChild(tr);
    });
  }
  function editTenant(i) {
    const t = tenants[i];
    document.getElementById("cccd").value = t.cccd;
    document.getElementById("ten").value = t.ten;
    document.getElementById("sdt").value = t.sdt;
    document.getElementById("ngaySinh").value = t.ngaySinh;
    document.getElementById("diaChi").value = t.diaChi;
    document.getElementById("tenantIndex").value = i;
  }
  function deleteTenant(i) { 
    tenants.splice(i,1); 
    renderTenants(); 
    updateTenantSelect();
  }
  document.getElementById("tenantSearch").addEventListener("input", renderTenants);

  // Cập nhật dropdown khách thuê trong form hợp đồng
  function updateTenantSelect() {
    const select = document.getElementById("contractTenant");
    select.innerHTML = `<option value="">-- Chọn khách thuê --</option>`;
    tenants.forEach((t,i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = `${t.cccd} - ${t.ten}`;
      select.appendChild(opt);
    });
  }

  // Thêm / Sửa Hợp đồng
  document.getElementById("contractForm").addEventListener("submit", e => {
    e.preventDefault();
    const idx = document.getElementById("contractIndex").value;
    const data = {
      maHD: document.getElementById("maHD").value,
      maPhong: document.getElementById("maPhong").value,
      tenantIndex: document.getElementById("contractTenant").value,
      ngayBD: document.getElementById("ngayBD").value,
      ngayKT: document.getElementById("ngayKT").value,
      tienCoc: document.getElementById("tienCoc").value
    };
    if (idx === "") {
      contracts.push(data);
    } else {
      contracts[idx] = data;
    }
    e.target.reset();
    document.getElementById("contractIndex").value = "";
    renderContracts();
  });

  // Hiển thị Hợp đồng
  function renderContracts() {
    const tbody = document.querySelector("#contractTable tbody");
    tbody.innerHTML = "";
    const search = document.getElementById("contractSearch").value.toLowerCase();
    contracts.filter(c => c.maHD.toLowerCase().includes(search) || c.maPhong.toLowerCase().includes(search)).forEach((c,i) => {
      const tenant = tenants[c.tenantIndex] ? `${tenants[c.tenantIndex].cccd} - ${tenants[c.tenantIndex].ten}` : "N/A";
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${c.maHD}</td><td>${c.maPhong}</td><td>${tenant}</td>
      <td>${c.ngayBD}</td><td>${c.ngayKT}</td><td>${c.tienCoc}</td>
      <td>
        <button class="edit" onclick="editContract(${i})">✏️</button>
        <button class="delete" onclick="deleteContract(${i})">❌</button>
      </td>`;
      tbody.appendChild(tr);
    });
  }
  function editContract(i) {
    const c = contracts[i];
    document.getElementById("maHD").value = c.maHD;
    document.getElementById("maPhong").value = c.maPhong;
    document.getElementById("contractTenant").value = c.tenantIndex;
    document.getElementById("ngayBD").value = c.ngayBD;
    document.getElementById("ngayKT").value = c.ngayKT;
    document.getElementById("tienCoc").value = c.tienCoc;
    document.getElementById("contractIndex").value = i;
  }
  function deleteContract(i) { contracts.splice(i,1); renderContracts(); }
  document.getElementById("contractSearch").addEventListener("input", renderContracts);

</script>

</body>
</html>