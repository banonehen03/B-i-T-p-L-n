<?php
ini_set('session.use_only_cookies', 1);
ini_set('session.use_strict_mode', 1);
session_start();

if (!isset($_SESSION['user'])) {
    // N·∫øu ch∆∞a login th√¨ quay l·∫°i form ƒëƒÉng nh·∫≠p
    header("Location: LoginForm/login.html");
    exit();
}
?>

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω nh√† tr·ªç</title>

  <!-- Link Bootstrap CDN -->
  <link rel="stylesheet" href="./asset/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>

    

    <div class="d-flex">


        
  <!-- Sidebar -->
  <div class="bg-dark text-white p-3 sidebar-fixed" style="width: 220px;">
    <h4 class="mb-4">Qu·∫£n l√Ω nh√† tr·ªç</h4>
    <ul class="nav flex-column">
      <li class="nav-item"><a href="#" id="quan-ly-phong-link" class="nav-link text-white"><i class="fa-solid fa-house"></i>Qu·∫£n l√Ω ph√≤ng</a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white"><i class="fa-solid fa-user"></i>Qu·∫£n l√Ω kh√°ch thu√™</a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white"><i class="fa-solid fa-users"></i>Qu·∫£n l√Ω nh√¢n vi√™n </a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white"><i class="fa-solid fa-money-bill"></i>Qu·∫£n l√Ω giao d·ªãch</a></li>
      <li class="nav-item"><a href="#" class="nav-link text-white"><i class="fa-solid fa-chart-simple"></i>B√°o c√°o</a></li>
    </ul>
  </div>

   <!-- N·ªôi dung ch√≠nh -->
 <div id="dashboard" class="flex-grow-1">

    <nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top">
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>


<div class="collapse navbar-collapse" id="navbarSupportedContent">
  <ul class="navbar-nav mb-2 mb-lg-0">
    <li class="nav-item">
      <a class="nav-link active" id="dashboard-link" aria-current="page" href="#dashboard">Trang ch·ªß</a>
    </li>
  </ul>

  <!-- √î t√¨m ki·∫øm ƒë·∫∑t ·ªü gi·ªØa -->
  <form class="d-flex ms-3" role="search">
    <div class="input-group">
      <input class="form-control" type="search" placeholder="T√¨m ki·∫øm" aria-label="Search"/>
      <button class="btn btn-outline-success" type="button" style="color: black;">T√¨m ki·∫øm</button>
    </div>
  </form>


<!-- Dark Mode + ƒêƒÉng xu·∫•t b√™n ph·∫£i -->
<div class="ms-auto d-flex align-items-center gap-2">
  <button class="btn btn-outline-secondary" id="dark-mode-toggle">
    üåô Dark Mode
  </button>
    <span class="text-white fw-bold">
    üë§ <?php echo htmlspecialchars($_SESSION['user']); ?>
  </span>
  <button class="btn btn-outline-danger" id="logout-button">ƒêƒÉng xu·∫•t</button>
</div>



</nav>

<div class="container-fluid p-4">
    <div id="dashboard-view">
        <h2 class="dashboard-title mb-4"><i class="fa-solid fa-calendar-days"></i> B·∫£ng ƒëi·ªÅu khi·ªÉn</h2>

        <div class="row">
            <div class="col-md-3 mb-4">
                <div class="card text-white bg-primary h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="card-title ">T·ªîNG S·ªê PH√íNG</h5>
                                <h2 class="fw-bold" id="total-rooms-stat">12</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-4">
    <div class="card text-white bg-secondary h-100">
        <div class="card-body">
            <h5 class="card-title" style="color: rgb(238, 2, 2);">PH√íNG TR·ªêNG</h5>
            <h2 class="fw-bold" id="vacant-rooms-stat">0</h2>
        </div>
    </div>
</div>

<div class="col-md-3 mb-4">
    <div class="card text-white bg-danger h-100">
        <div class="card-body">
            <h5 class="card-title" style="color: rgb(26, 202, 10);">ƒêANG THU√ä</h5>
            <h2 class="fw-bold" id="occupied-rooms-stat">0</h2>
        </div>
    </div>
</div>

            <div class="col-md-3 mb-4">
                <div class="card text-white bg-success h-100">
                    <div class="card-body">
                        <h5 class="card-title">KH√ÅCH THU√ä</h5>
                        <h2 class="fw-bold" id="total-tenants-stat">8</h2>
                    </div>
                </div>
            </div>


            <div class="col-md-3 mb-4">
                <div class="card text-white bg-info h-100">
                     <div class="card-body">
                        <h5 class="card-title">T·ª∂ L·ªÜ L·∫§P ƒê·∫¶Y</h5>
                        <h2 class="fw-bold" id="occupancy-rate-stat">66.7%</h2>
                        <div class="progress" style="height: 5px;">
                            <div class="progress-bar bg-light" role="progressbar" style="width: 66.7%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-4">
                <div class="card text-white bg-warning h-100">
                    <div class="card-body">
                        <h5 class="card-title">DOANH THU TH√ÅNG</h5>
                        <h2 class="fw-bold" id="monthly-revenue-stat">24.0M</h2>
                        <p>VNƒê (d·ª± ki·∫øn)</p>
                    </div>
                </div>
            </div>
        </div>

  
</div>

    <div id="room-list-view" class="d-none">
        <button class="btn btn-success" id="add-room-button">
    <i class="fa fa-plus"></i> Th√™m ph√≤ng m·ªõi
  </button>

    <button class="btn btn-success" id="show-add-tenant-modal">
    <i class="fa fa-plus"></i> Th√™m kh√°ch thu√™
  </button>
<h2 class="list-card mb-1"><i class="fa-solid fa-list-ul"></i> Danh s√°ch ph√≤ng</h2>

        <div class="container mt-4" id="room-container">
            <div class="row">
                
                </div>
        </div>
    </div>

</div>



<div class="container mt-4">
  <div class="row d-none" >
    <div class="col-md-3 mb-1">
      <div class="card p-3 bg-success text-white">
        <h2>Ph√≤ng 101</h2>
        <p><i class="fa-solid fa-user"></i> L∆∞u ƒê·ª©c H√≤a</p>
        <h6>3.000.000 VNƒê</h6>
        <p>S·ªë l∆∞·ª£ng ng∆∞·ªùi: <span>2</span></p>
        <div class="mt-2">
          <button class="btn btn-warning">Ch·ªânh s·ª≠a</button>
          <button class="btn btn-danger">X√≥a ph√≤ng</button>
        </div>
      </div>
    </div>


    
      
    
    <!-- Th√™m nhi·ªÅu card kh√°c th√¨ n√≥ t·ª± ƒë·ªông xu·ªëng d√≤ng -->
  </div>
</div>

  <!-- Ph·∫ßn ·∫©n c·ªßa th√™m/s·ª≠a/x√≥a ph√≤ng -->
<div class="modal fade" id="addTenantModal" tabindex="-1" aria-labelledby="addTenantModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addTenantModalLabel">Th√¥ng tin kh√°ch thu√™ ph√≤ng</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="add-tenant-form">
          <div class="mb-3">
            <label for="vacant-room-select" class="form-label">Ch·ªçn ph√≤ng tr·ªëng:</label>
            <select class="form-select" id="vacant-room-select" required>
              </select>
          </div>
          <div class="mb-3">
            <label for="tenant-name" class="form-label">T√™n kh√°ch thu√™:</label>
            <input type="text" class="form-control" id="tenant-name" required>
          </div>
          <div class="mb-3">
            <label for="tenant-occupants" class="form-label">S·ªë l∆∞·ª£ng ng∆∞·ªùi ·ªü:</label>
            <input type="number" class="form-control" id="tenant-occupants" min="1" required>
          </div>
          <div class="mb-3">
              <label for="tenant-price" class="form-label">Gi√° thu√™ (VNƒê):</label>
              <input type="text" class="form-control" id="tenant-price" value="3.000.000" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        <button type="button" class="btn btn-primary" id="save-tenant-button">L∆∞u th√¥ng tin</button>
      </div>
    </div>
  </div>
</div>
  



<div class="modal fade" id="editRoomModal" tabindex="-1" aria-labelledby="editRoomModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="editRoomModalLabel">Ch·ªânh s·ª≠a th√¥ng tin ph√≤ng</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="edit-room-form">
          <h4 id="editing-room-name"></h4>
          <hr>
          <div class="mb-3">
            <label for="edit-room-status" class="form-label">Tr·∫°ng th√°i:</label>
            <select class="form-select" id="edit-room-status">
              <option value="occupied">ƒê√£ thu√™</option>
              <option value="vacant">Tr·ªëng</option>
            </select>
          </div>
          <div id="tenant-info-wrapper">
            <div class="mb-3">
              <label for="edit-tenant-name" class="form-label">T√™n kh√°ch thu√™:</label>
              <input type="text" class="form-control" id="edit-tenant-name">
            </div>
            <div class="mb-3">
              <label for="edit-tenant-occupants" class="form-label">S·ªë l∆∞·ª£ng ng∆∞·ªùi ·ªü:</label>
              <input type="number" class="form-control" id="edit-tenant-occupants" min="1">
            </div>
          </div>
          <div class="mb-3">
              <label for="edit-tenant-price" class="form-label">Gi√° thu√™ (VNƒê):</label>
              <input type="text" class="form-control" id="edit-tenant-price">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
        <button type="button" class="btn btn-primary" id="save-edit-button">L∆∞u thay ƒë·ªïi</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="deleteConfirmModalLabel">X√°c nh·∫≠n x√≥a</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body"  id="delete-modal-body">
                B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ph√≤ng n√†y kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-button">X√≥a</button>
            </div>
        </div>
    </div>
</div>





<div class="modal fade" id="addRoomModal" tabindex="-1" aria-labelledby="addRoomModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addRoomModalLabel">Th√™m ph√≤ng m·ªõi</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body">
        <form id="add-room-form">
          <div class="mb-3">
            <label for="new-room-name" class="form-label">T√™n ph√≤ng:</label>
            <input type="text" class="form-control" id="new-room-name" required>
          </div>
          <div class="mb-3">
            <label for="new-room-price" class="form-label">Gi√° thu√™ (VNƒê):</label>
            <input type="text" class="form-control" id="new-room-price" value="3.000.000" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
        <button type="button" class="btn btn-primary" id="save-room-button">Th√™m ph√≤ng</button>
      </div>
    </div>
  </div>
</div>

 <script src="./asset/bootstrap/js/bootstrap.bundle.min.js"></script>

<script>
  // =========================
// Ki·ªÉm tra ƒëƒÉng nh·∫≠p
// =========================
document.getElementById('logout-button').addEventListener('click', () => {
  window.location.href = 'logout.php';
});

// =========================
// Ch·ªù DOM load xong
// =========================
document.addEventListener('DOMContentLoaded', function () {

  const darkModeToggle = document.getElementById("dark-mode-toggle");

// Ki·ªÉm tra tr·∫°ng th√°i dark mode khi load trang
if (localStorage.getItem("darkMode") === "enabled") {
  document.body.classList.add("dark-mode");
  darkModeToggle.textContent = "‚òÄÔ∏è Light Mode";
}

darkModeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark-mode");

  if (document.body.classList.contains("dark-mode")) {
    localStorage.setItem("darkMode", "enabled");
    darkModeToggle.textContent = "‚òÄÔ∏è Light Mode";
  } else {
    localStorage.setItem("darkMode", "disabled");
    darkModeToggle.textContent = "üåô Dark Mode";
  }
});

  const dashboardLink = document.getElementById('dashboard-link');
  const quanLyPhongLink = document.getElementById('quan-ly-phong-link');
  const dashboardView = document.getElementById('dashboard-view');
  const roomListView = document.getElementById('room-list-view');
  const roomListRow = document.querySelector('#room-container .row');

  // Modals
  const addRoomModal = new bootstrap.Modal(document.getElementById('addRoomModal'));
  const addTenantModal = new bootstrap.Modal(document.getElementById('addTenantModal'));
  const editRoomModal = new bootstrap.Modal(document.getElementById('editRoomModal'));
  const deleteConfirmModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));

  // Forms
  const addTenantForm = document.getElementById('add-tenant-form');
  const addRoomForm = document.getElementById('add-room-form');

  // Buttons
  const addRoomButton = document.getElementById('add-room-button');
  const saveRoomButton = document.getElementById('save-room-button');
  const showAddTenantBtn = document.getElementById('show-add-tenant-modal');
  const saveTenantButton = document.getElementById('save-tenant-button');
  const confirmDeleteButton = document.getElementById('confirm-delete-button');
  const saveEditButton = document.getElementById('save-edit-button');

  // Selects / Inputs
  const vacantRoomSelect = document.getElementById('vacant-room-select');

  // Bi·∫øn t·∫°m
  let roomToProcess = null;

  // =========================
  // H√†m l∆∞u / t·∫£i LocalStorage
  // =========================
  function saveRoomsToLocalStorage() {
    localStorage.setItem('roomManagementData', roomListRow.innerHTML);
  }

  function loadRoomsFromLocalStorage() {
    const saved = localStorage.getItem('roomManagementData');
    if (saved) {
      roomListRow.innerHTML = saved;
    }
  }

  // =========================
  // Chuy·ªÉn ƒë·ªïi m√†n h√¨nh
  // =========================
  dashboardLink.addEventListener('click', (e) => {
    e.preventDefault();
    dashboardView.classList.remove('d-none');
    roomListView.classList.add('d-none');
  });

  quanLyPhongLink.addEventListener('click', (e) => {
    e.preventDefault();
    dashboardView.classList.add('d-none');
    roomListView.classList.remove('d-none');
  });

  // =========================
  // Th√™m ph√≤ng m·ªõi
  // =========================
  addRoomButton.addEventListener('click', () => {
    addRoomModal.show();
  });

  saveRoomButton.addEventListener('click', () => {
    const roomName = document.getElementById('new-room-name').value;
    const roomPrice = document.getElementById('new-room-price').value;

    if (!roomName || !roomPrice) {
      alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin ph√≤ng!');
      return;
    }

    const newRoom = document.createElement('div');
    newRoom.className = 'col-md-3 mb-1';
    newRoom.innerHTML = `
      <div class="card p-3 bg-secondary text-white">
        <h2>${roomName}</h2>
        <p><i class="fa-solid fa-door-open"></i> <strong>Tr·∫°ng th√°i: Tr·ªëng</strong></p>
        <h6>${roomPrice} VNƒê</h6>
        <p>S·ªë l∆∞·ª£ng ng∆∞·ªùi: <span>Tr·ªëng</span></p>
        <div class="mt-2">
          <button class="btn btn-primary">Cho thu√™</button>
          <button class="btn btn-danger">X√≥a ph√≤ng</button>
        </div>
      </div>
    `;
    roomListRow.appendChild(newRoom);

    saveRoomsToLocalStorage();
    addRoomModal.hide();
    addRoomForm.reset();
  });

  // =========================
  // Th√™m kh√°ch thu√™
  // =========================
  showAddTenantBtn.addEventListener('click', () => {
    const vacantRooms = roomListRow.querySelectorAll('.card.bg-secondary');
    vacantRoomSelect.innerHTML = '';

    if (vacantRooms.length === 0) {
      vacantRoomSelect.add(new Option('Kh√¥ng c√≥ ph√≤ng tr·ªëng n√†o', '', false, true));
    } else {
      vacantRooms.forEach(card => {
        const roomName = card.querySelector('h2').textContent;
        vacantRoomSelect.add(new Option(roomName, roomName));
      });
    }
    addTenantModal.show();
  });

  saveTenantButton.addEventListener('click', () => {
    const selectedRoomName = vacantRoomSelect.value;
    const tenantName = document.getElementById('tenant-name').value.trim();
    const tenantOccupants = document.getElementById('tenant-occupants').value;
    const tenantPrice = document.getElementById('tenant-price').value;

    if (!selectedRoomName || !tenantName || !tenantOccupants) {
      alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin.');
      return;
    }

    const allCards = roomListRow.querySelectorAll('.card');
    allCards.forEach(card => {
      const roomNameH2 = card.querySelector('h2');
      if (roomNameH2 && roomNameH2.textContent === selectedRoomName) {
        card.className = 'card p-3 bg-success text-white';
        card.innerHTML = `
          <h2>${selectedRoomName}</h2>
          <p><i class="fa-solid fa-user"></i> ${tenantName}</p>
          <h6>${tenantPrice} VNƒê</h6>
          <p>S·ªë l∆∞·ª£ng ng∆∞·ªùi: <span>${tenantOccupants}</span></p>
          <div class="mt-2">
            <button class="btn btn-warning">Ch·ªânh s·ª≠a</button>
            <button class="btn btn-danger">X√≥a ph√≤ng</button>
          </div>
        `;
      }
    });

    saveRoomsToLocalStorage();
    addTenantModal.hide();
    addTenantForm.reset();
  });

  // =========================
  // X·ª≠ l√Ω s·ª± ki·ªán trong danh s√°ch ph√≤ng
  // =========================
  roomListRow.addEventListener('click', (e) => {
    const button = e.target.closest('button');
    if (!button) return;

    const roomCardWrapper = button.closest('.col-md-3');
    if (!roomCardWrapper) return;

    const card = roomCardWrapper.querySelector('.card');
    const roomName = card.querySelector('h2').textContent;

    // X√≥a ph√≤ng
    if (button.classList.contains('btn-danger')) {
      roomToProcess = roomCardWrapper;
      if (card.classList.contains('bg-success')) {
        document.getElementById('delete-modal-body').textContent =
          'B·∫°n c√≥ mu·ªën x√≥a kh√°ch thu√™ v√† chuy·ªÉn ph√≤ng n√†y v·ªÅ tr·∫°ng th√°i "Tr·ªëng" kh√¥ng?';
      } else {
        document.getElementById('delete-modal-body').textContent =
          'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn ph√≤ng n√†y kh√¥ng?';
      }
      deleteConfirmModal.show();
    }

    // Cho thu√™ ho·∫∑c ch·ªânh s·ª≠a
    // X·ª≠ l√Ω n√∫t trong card ph√≤ng
roomListRow.addEventListener('click', (e) => {
  const button = e.target.closest('button');
  if (!button) return;

  const roomCardWrapper = button.closest('.col-md-3');
  if (!roomCardWrapper) return;

  const card = roomCardWrapper.querySelector('.card');
  const roomName = card.querySelector('h2').textContent;

  // X√≥a ph√≤ng
  if (button.classList.contains('btn-danger')) {
    roomToProcess = roomCardWrapper;
    if (card.classList.contains('bg-success')) {
      document.getElementById('delete-modal-body').textContent =
        'B·∫°n c√≥ mu·ªën x√≥a kh√°ch thu√™ v√† chuy·ªÉn ph√≤ng n√†y v·ªÅ tr·∫°ng th√°i "Tr·ªëng" kh√¥ng?';
    } else {
      document.getElementById('delete-modal-body').textContent =
        'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn ph√≤ng n√†y kh√¥ng?';
    }
    deleteConfirmModal.show();
  }

  // Cho thu√™ (btn-primary)
  if (button.classList.contains('btn-primary')) {
    // G√°n ph√≤ng ƒëang x·ª≠ l√Ω
    roomToProcess = roomCardWrapper;

    // ƒê·∫∑t s·∫µn ph√≤ng ƒë∆∞·ª£c ch·ªçn trong modal Th√™m kh√°ch
    vacantRoomSelect.innerHTML = '';
    vacantRoomSelect.add(new Option(roomName, roomName, true, true));

    // Hi·ªán modal Th√™m kh√°ch thu√™
    addTenantModal.show();
  }

  // Ch·ªânh s·ª≠a (btn-warning)
  if (button.classList.contains('btn-warning')) {
    roomToProcess = roomCardWrapper;
    const priceText = card.querySelector('h6') ? card.querySelector('h6').textContent.replace(' VNƒê', '') : '';

    document.getElementById('editing-room-name').textContent = roomName;
    document.getElementById('edit-tenant-price').value = priceText;

    const statusSelect = document.getElementById('edit-room-status');
    const tenantInfoWrapper = document.getElementById('tenant-info-wrapper');

    if (card.classList.contains('bg-success')) {
      statusSelect.value = 'occupied';
      tenantInfoWrapper.style.display = 'block';
      document.getElementById('edit-tenant-name').value =
        card.querySelector('p i.fa-user').nextSibling.textContent.trim();
      document.getElementById('edit-tenant-occupants').value = card.querySelector('p span').textContent;
    } else {
      statusSelect.value = 'vacant';
      tenantInfoWrapper.style.display = 'none';
      document.getElementById('edit-tenant-name').value = '';
      document.getElementById('edit-tenant-occupants').value = '';
    }
    editRoomModal.show();
  }
});

  });


// =========================
// L∆∞u thay ƒë·ªïi khi ch·ªânh s·ª≠a ph√≤ng
// =========================
saveEditButton.addEventListener('click', () => {
  if (!roomToProcess) return;

  const card = roomToProcess.querySelector('.card');
  const roomName = document.getElementById('editing-room-name').textContent;
  const status = document.getElementById('edit-room-status').value;
  const tenantName = document.getElementById('edit-tenant-name').value.trim();
  const tenantOccupants = document.getElementById('edit-tenant-occupants').value;
  const tenantPrice = document.getElementById('edit-tenant-price').value;

  // N·∫øu tr·∫°ng th√°i l√† "ƒê√£ thu√™"
  if (status === 'occupied') {
    card.className = 'card p-3 bg-success text-white';
    card.innerHTML = `
      <h2>${roomName}</h2>
      <p><i class="fa-solid fa-user"></i> ${tenantName}</p>
      <h6>${tenantPrice} VNƒê</h6>
      <p>S·ªë l∆∞·ª£ng ng∆∞·ªùi: <span>${tenantOccupants}</span></p>
      <div class="mt-2">
        <button class="btn btn-warning">Ch·ªânh s·ª≠a</button>
        <button class="btn btn-danger">X√≥a ph√≤ng</button>
      </div>
    `;
  } else { // N·∫øu l√† "Tr·ªëng"
    card.className = 'card p-3 bg-secondary text-white';
    card.innerHTML = `
      <h2>${roomName}</h2>
      <p><i class="fa-solid fa-door-open"></i> <strong>Tr·∫°ng th√°i: Tr·ªëng</strong></p>
      <h6>${tenantPrice} VNƒê</h6>
      <p>S·ªë l∆∞·ª£ng ng∆∞·ªùi: <span>Tr·ªëng</span></p>
      <div class="mt-2">
        <button class="btn btn-primary">Cho thu√™</button>
        <button class="btn btn-danger">X√≥a ph√≤ng</button>
      </div>
    `;
  }

  saveRoomsToLocalStorage();   // L∆∞u l·∫°i LocalStorage
  updateDashboardStats();      // C·∫≠p nh·∫≠t Dashboard
  editRoomModal.hide();        // ƒê√≥ng modal
});
  
  // =========================
  // X√°c nh·∫≠n x√≥a
  // =========================
  confirmDeleteButton.addEventListener('click', () => {
    if (!roomToProcess) return;
    const card = roomToProcess.querySelector('.card');
    const roomName = card.querySelector('h2').textContent;
    const price = card.querySelector('h6').textContent;

    if (card.classList.contains('bg-success')) {
      card.className = 'card p-3 bg-secondary text-white';
      card.innerHTML = `
        <h2>${roomName}</h2>
        <p><i class="fa-solid fa-door-open"></i> <strong>Tr·∫°ng th√°i: Tr·ªëng</strong></p>
        <h6>${price}</h6>
        <p>S·ªë l∆∞·ª£ng ng∆∞·ªùi: <span>Tr·ªëng</span></p>
        <div class="mt-2">
          <button class="btn btn-primary">Cho thu√™</button>
          <button class="btn btn-danger">X√≥a ph√≤ng</button>
        </div>
      `;
    } else {
      roomToProcess.remove();
    }

    saveRoomsToLocalStorage();
    deleteConfirmModal.hide();
  });

  // =========================
  // T√¨m ki·∫øm ph√≤ng
  // =========================
  const searchInput = document.querySelector('form[role="search"] input');
  searchInput.addEventListener('keyup', (event) => {
    const searchTerm = event.target.value.toLowerCase();
    const allRooms = roomListRow.querySelectorAll('.col-md-3');
    allRooms.forEach(room => {
      const roomContent = room.textContent.toLowerCase();
      room.style.display = roomContent.includes(searchTerm) ? 'block' : 'none';
    });
  });

  // =========================
  // Load l·∫°i d·ªØ li·ªáu khi m·ªü trang
  // =========================
  loadRoomsFromLocalStorage();




  //t√≠nh s·ªë li·ªáu dashboard
function updateDashboardStats() {
  const allRooms = document.querySelectorAll('#room-container .card');
  const totalRooms = allRooms.length;

  let totalTenants = 0;
  let occupiedRooms = 0;
  let revenue = 0;

  allRooms.forEach(card => {
    const occupants = card.querySelector('p span')?.textContent;
    const priceText = card.querySelector('h6')?.textContent.replace(' VNƒê', '').replace(/\./g, '').trim();

    if (card.classList.contains('bg-success')) {
      occupiedRooms++;
      totalTenants += parseInt(occupants) || 0;
      revenue += parseInt(priceText) || 0;
    }
  });

  const vacantRooms = totalRooms - occupiedRooms;
  const occupancyRate = totalRooms > 0 ? ((occupiedRooms / totalRooms) * 100).toFixed(1) : 0;

  // C·∫≠p nh·∫≠t dashboard
  document.getElementById('total-rooms-stat').textContent = totalRooms;
  document.getElementById('total-tenants-stat').textContent = totalTenants;
  document.getElementById('occupancy-rate-stat').textContent = occupancyRate + '%';
  document.querySelector('.progress-bar').style.width = occupancyRate + '%';
  document.getElementById('monthly-revenue-stat').textContent = (revenue / 1_000_000) + 'M';

  
  document.getElementById('vacant-rooms-stat').textContent = vacantRooms;
  document.getElementById('occupied-rooms-stat').textContent = occupiedRooms;
}


saveRoomsToLocalStorage();
updateDashboardStats();

});

</script>
</body>
</html>
